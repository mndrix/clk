#!/usr/bin/perl
use strict;
use warnings;
use FindBin;  # TODO we can probably do this faster ourselves

# adjust the environment, if necessary
if ( not $ENV{CLK_ENVIRONMENT_ALREADY_ADJUSTED} ) {
    $ENV{CLK_ROOT} ||= './play';
    $ENV{PERL5LIB}   = "$FindBin::Bin/lib:" . ( $ENV{PERL5LIB} || '' );
    $ENV{PATH}       = $FindBin::Bin . ':' . ( $ENV{PATH} || '' );
    $ENV{CLK_ENVIRONMENT_ALREADY_ADJUSTED} = 1;
}

# the user must identify himself
die "Please set CLK_IDENTITY to indicate who you are.\n"
  . "For example:\n"
  . "\n"
  . "  export CLK_IDENTITY=somebody\@example.com\n"
  if not defined $ENV{CLK_IDENTITY};

my $command = shift or die "Please specfy a clk command\n";

exec "clk-$command", @ARGV;
